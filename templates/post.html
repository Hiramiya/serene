{% extends "_base.html" %}

{% block page %}post{% endblock page %}
{% block lang %}
{% set section = get_section(path="blog/_index.md", metadata_only=true) -%}
{% if page.extra.lang %}{{page.extra.lang}}{% elif section.extra.lang %}{{section.extra.lang}}{% else %}{{page.lang}}{% endif %}
{% endblock lang %}
{% block title %}{{ page.title }}{% endblock title %}
{% block desc -%}{% if page.summary %}{{ page.summary }}{% endif -%}{% endblock desc %}

{% block head %}
{% if page.extra.math %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
        ],
        throwOnError : false
        });
    });
</script>
{% endif %}
{% endblock head %}

{% block content %}
{% include "_header.html" %}
<div id="post-wrapper">
    <div id="blank"></div>
    <main>
        <div id="top"></div>
        <article>
            <h1>{{ page.title }}</h1>
            <div id="post-info">
                <div class="date">
                    <span id="publish">{{ page.date | date }}</span>
                    {% if page.updated and page.updated != page.date -%}
                    <span>Updated on <span id="updated">{{ page.updated | date }}</span></span>
                    {% endif -%}
                </div>
                <div class="tags">
                    {% for tag in page.taxonomies.tags -%}
                    {% set tag_slugify = tag | slugify -%}
                    <a href="{{ config.base_url ~ '/tags/' ~ tag_slugify }}"># {{ tag }}</a>
                    {%- endfor %}
                </div>
            </div>

            {% if page.extra.outdate_warn is defined %} {% set show_outdate_warn = page.extra.outdate_warn %}{% else %} {% set show_outdate_warn = config.extra.outdate_warn %}{% endif %}
            {% if page.extra.outdate_warn_days is defined %} {% set outdate_warn_days = page.extra.outdate_warn_days %}{% else %} {% set outdate_warn_days = config.extra.outdate_warn_days %}{% endif %}

            {% if show_outdate_warn -%}
            <blockquote id="outdate_warn" class="note hidden" data-days="{{ outdate_warn_days }}"
                data-warn-text-before="{{ config.extra.outdate_warn_text_before }}" data-warn-text-after="{{ config.extra.outdate_warn_text_after }}">
                <i class="ri-alarm-warning-line ri-lg"></i><span></span>
            </blockquote>
            {% endif %}
            
            {{ page.content | safe }}

            {% set cc = false %}
            {% if page.extra.cc_license is defined and page.extra.cc_license == true %}{% set cc = true %}
            {% elif page.extra.cc_license is undefined and config.extra.cc_license == true %}{% set cc = true %}
            {% endif %}

            {% if cc %}
            <blockquote id="cc_license" class="note">
                <i class="ri-creative-commons-line ri-lg"></i>
                <div class="content">{{ config.extra.cc_license_statement | trim | markdown | safe }}</div>
            </blockquote>
            {% endif %}
        </article>
        
        {% set show_comment = false %}
        {% if page.extra.show_comment %}
        {% set show_comment = true %}
        {% elif page.extra.show_comment is undefined %}
        {% set show_comment = true %}
        {% endif %}

        {% if show_comment and config.extra.comment == "gitalk" %}
        <div id="gitalk-container" class="comment"></div>
        {% endif %}

        {% if show_comment and config.extra.comment == "disqus" %}
        <div id="disqus_thread" class="comment"></div>
        {% endif %}

        {% if show_comment and config.extra.comment == "disqus_js" %}
        <div id="disqus_thread" class="comment"></div>
        {% endif %}

        {% include "_footer.html" %}
    </main>
    <aside {% if config.extra.blur_effect %} class="blur" {% endif %}>
        {% if page.extra.toc is defined %} {% set show_toc = page.extra.toc %}{% else %} {% set show_toc = config.extra.toc %} {% endif %}
        {% if show_toc and page.toc %}
        <nav>
            <ul>
                {% for h2 in page.toc %}
                <li>
                    <a class="toc-h2" href="#{{ h2.id | safe }}">{{ h2.title }}</a>
                    {% if h2.children %}
                    <ul>
                        {% for h3 in h2.children %}
                        <li>
                            <a class="toc-h3" href="#{{ h3.id | safe }}">{{ h3.title }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </nav>
        {% endif %}
        {% if config.extra.back_to_top_button %}
        <button id="back-to-top" aria-label="back to top">
            {% set icon = load_data(path="static/icon/arrow-up.svg") %}
            {{ icon | safe }}
        </button>
        {% endif %}
    </aside>
</div>
{% endblock content %}

{% block script %}
<script src="/js/lightense.min.js"></script>
{% if page.extra.mermaid %}
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({ startOnLoad: true });</script>
{% endif %}
{% endblock script %}
